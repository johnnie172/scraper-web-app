{% extends "base.html" %}


<!DOCTYPE html>
<html lang="en">
{% block content %}
<body>
    <div id="items">

    </div>
    <script type="text/javascript">        
    	var itemId = 0
        function appendData(data) {
		  var mainContainer = document.getElementById("items");
		  for (var i = 0; i < data.length; i++) {
		    var div = document.createElement("div");
		    div.innerHTML = 'id: ' + data[i].id + '. stock: ' + data[i].in_stock + '. lowest price: ' + data[i].lowest + '. target price: ' + data[i].target_price;

		    mainContainer.appendChild(div);
		  }
		}

        function getItems() {
        	fetch('/api/items')
        		.then(response => response.json())
        		.then(CreateTableFromJSON)
        }

        function CreateTableFromJSON(data) {

        console.log(data)
        // EXTRACT VALUE FOR HTML HEADER. 
        var col = [];
        for (var i = 0; i < data.length; i++) {
            for (var key in data[i]) {
            	if (key != 'id' && key != 'user_id') {
                if (col.indexOf(key) === -1) {
                    col.push(key);
                }}

            }
        }


        // CREATE DYNAMIC TABLE.
        var table = document.createElement("table");

        // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

        var tr = table.insertRow(-1);                   // TABLE ROW.

        for (var i = 0; i < col.length; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }

        // ADD JSON DATA TO THE TABLE AS ROWS.
        for (var i = 0; i < data.length; i++) {

            tr = table.insertRow(-1);

            // ADDING CELLS.
            for (var j = 0; j < col.length; j++) {
                var tabCell = tr.insertCell(-1);
                tabCell.innerHTML = data[i][col[j]];
                
                // ADDING CELLS WITH LINKS.
                if (j === 0) {
                	var urlData = data[i][col[j]]
                	tabCell.innerHTML = `<a href="${urlData}">Change</a>`;
                }

                if (j === 1) {
                	var urlData = data[i][col[j]]
                	tabCell.innerHTML = `<a href="${urlData}">Delete</a>`;
                }
            }
        }

        // ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
        var divContainer = document.getElementById("items");
        divContainer.innerHTML = "";
        divContainer.appendChild(table);
    }
        function getItems() {
    	fetch('/api/items')
    		.then(response => response.json())
    		.then(CreateTableFromJSON)
        }

        getItems();


    </script>

        <h1>Add Item</h1>
    <form action="/item-alert" method="post">

      <div class="container">
        <label for="item_url"><b>Item url</b></label>
        <input type="text" placeholder="Enter URL" name="item_url" required>

        <button type="submit">Add item</button>

      </div>

      <div class="container" style="background-color:#f1f1f1">
      </div>
    </form>

</body>
{% endblock content %}
</html>